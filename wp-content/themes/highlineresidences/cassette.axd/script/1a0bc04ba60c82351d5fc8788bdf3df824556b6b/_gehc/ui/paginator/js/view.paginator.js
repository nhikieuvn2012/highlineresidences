(function(n,t){extend("gehc._prototypes.paginator.view.controller",Backbone.View.extend({events:{"click li .goto-page":"clickGoto","click li .page-back":"clickBack","click li .page-forward":"clickForward"},initialize:function(n){if(n=n||{},_.defaults(this,n),!this.contentView)throw"You need provide a gehc._prototypes.paginator.view.content instance to instantiate gehc._prototypes.paginator.view.controller.";this.pagerList=t("ul",this.el),_.defaults(this,{collectionType:gehc._prototypes.paginator.collection.contentItems,templates:gehc._prototypes.paginator.template,targetPageAmount:5,controllerEl:t(".paginator-controller-view")}),this.fadeSpeed=this.contentView.slideSpeed/2,this.collection=this.collection||new this.collectionType,this.contentView.setContent(this.collection,0),this.collection.setPageSize(this.collection.getPageSize()),this.collection.setCurrentPage(0)},clickGoto:function(n){var r,u,i;n.preventDefault(),r=t(n.target),i=r.closest("li").data("pageNumber"),typeof i=="undefined"&&(i=r.closest("li").find("span").html()),u=parseInt(i,10)-1,u!==this.collection.getCurrentPage()&&this.gotoPage(u)},clickBack:function(n){n.preventDefault(),this.pageBackward()},clickForward:function(n){n.preventDefault(),this.pageForward()},render:function(n){var t;t=this,this.contentView.render(),this.slideToCurrentPage(n),t.pagerList.children().remove(),t.renderBackButton(),t.renderItems(),t.renderForwardButton(),t.renderTextOutput()},renderBackButton:function(){var n;n=t(Mustache.to_html(this.templates.pageBackward,{})),this.pagerList.append(n)},renderForwardButton:function(){var n;n=t(Mustache.to_html(this.templates.pageForward,{})),this.pagerList.append(n)},renderItems:function(){var r,n,i,u,f;this.collection.length>0&&(i=Math.floor(this.collection.getCacheStart()/this.collection.getPageSize()),u=i+Math.ceil(this.collection.length/this.collection.getPageSize()),i<u||(u=i+1),f=this.generateCenteredPageList(this.collection.getCurrentPage()),n=t(),_.each(f,function(i){r=t(Mustache.to_html(this.templates.pageTo,{pageNumber:i+1})),i===this.collection.getCurrentPage()&&r.addClass("active"),n=n.add(r)},this),this.pagerList.append(n),this.gotoLinks=this.pagerList.find(".goto-page span"),this.fadeOut(!0))},fadeAndRenderItems:function(){var n;n=this,this.fadeOut(!1,function(){n.renderItems()})},fadeOut:function(n,i){var r;r=n===!0?0:this.fadeSpeed,this.gotoLinks?this.gotoLinks.animateAndFinishOnce({opacity:.5},{duration:r/2,complete:i||t.noop}):(i||t.noop)()},fadeIn:function(n){var i;i=this,this.gotoLinks?this.gotoLinks.animateAndFinishOnce({opacity:1},{duration:this.fadeSpeed*2,complete:function(){i.gotoLinks.removeInlineFilter(),(n||t.noop)()}}):(n||t.noop)()},renderTextOutput:function(){var i,n,r;n=this.collection.getCurrentPage()*this.collection.getPageSize()+1,r=Math.min(n+this.collection.getPageSize()-1,this.collection.getMaxItems()),i=t(Mustache.to_html(this.templates.textOutput,{start:n,end:r,total:this.collection.getMaxItems()})),this.pagerList.append(i)},gotoPage:function(n){var t;this.isLoadingData!==!0&&this.isRendering!==!0&&(t=this,this.collection.setCurrentPage(n),t.isRequestedPageCached(n)?t.render():t.updateData())},pageBackward:function(){var n;n=this.collection.getCurrentPage(),n>0&&this.gotoPage(this.collection.getCurrentPage()-1)},pageForward:function(){var n;n=this.collection.getCurrentPage(),n<Math.ceil(this.collection.getMaxItems()/this.collection.getPageSize())-1&&this.gotoPage(this.collection.getCurrentPage()+1)},slideToCurrentPage:function(n){var t,i;this.collection.length>0&&this.collection.getPageSize()>0&&(t=this.collection.getCurrentPage(),i=t===0?0:t-this.collection.getCacheStart()/this.collection.getPageSize(),this.contentView.gotoItem(i,n))},isRequestedPageCached:function(n){var t,f,i,r,u;return u=this.collection.getPageSize(),t=this.collection.getCacheStart(),i=this.collection.length,f=u-this.collection.getMaxCacheSize()%i,r=n*u,r<t||r+f>t+i?!1:!0},refreshContentAndController:function(){this.contentView.reset(this.collection,0),this.render(!0)},generateCenteredPageList:function(n){var t,r,u,i,f;for(t=[n],this.numberOfPages=Math.ceil(this.collection.getMaxItems()/this.collection.getPageSize()),this.targetPageAmount?i=Math.min(this.targetPageAmount,this.numberOfPages):(i=Math.ceil(this.collection.getMaxCacheSize()/this.collection.getPageSize()),i=Math.min(i,this.numberOfPages)),f=0;t.length<i;)f%2==0?(u=_.last(t)+1,u<this.numberOfPages&&t.push(u)):(r=t[0]-1,r>=0&&t.unshift(r)),f++;return t},updateData:function(n,t){var i;i=this,n=n||{},startFrom=this.collection.calculateStartPoint(),_.extend(n,{startFrom:startFrom}),this.isLoadingData=!0,this.contentView.showLoadingIndicator(),this.collection.updateData(n,function(n){i.refreshContentAndController(),i.contentView.hideLoadingIndicator(n.totalItems),i.isLoadingData=!1,t&&t(n)})}})),extend("gehc._prototypes.paginator.view.content",Backbone.View.extend({events:{},initialize:function(n){n=n||{},_.defaults(this,n),this.listContainer=t(".list-container",this.el),this.itemList=t(".paginated-items",this.el),_.defaults(this,{itemTemplate:gehc._prototypes.paginator.template.item,pageTemplate:gehc._prototypes.paginator.template.page,slideSpeed:400,resultsPerPage:12}),this.setupMask()},setupMask:function(){this.itemList.css({position:"relative"})},render:function(){var n,t;t=Math.ceil(this.collection.length/this.resultsPerPage),this.itemList.children().remove(),n=this.buildPages(t),this.fillPages(n)},buildPages:function(n){var r,u;for(r=t(),i=0;i<n;i++)u=t(Mustache.to_html(this.pageTemplate,{})),r=r.add(u);return r},fillPages:function(n){var i,r;i=this,r=t(document.createElement("div")),n.each(function(n,u){var e,f,o;u=t(u),f=n*i.resultsPerPage,o=f+i.resultsPerPage,e=i.collection.models.slice(f,o),i.fillPage(u,e),r.append(u)}),i.itemList.append(r.children())},fillPage:function(n,i){_.each(i,function(i){var r;r=t(innerShiv(Mustache.to_html(this.itemTemplate,i.toJSON()),!1)),n.append(r)},this)},setContent:function(n){this.collection=n},reset:function(){this.itemList.css({left:""})},gotoItem:function(n,t,i){var r;r=this.itemList.children().eq(n).position(),r!=null&&this.itemList.stop(!0,!0).animate({left:-r.left},{duration:t===!0?1:this.slideSpeed,complete:i})},showLoadingIndicator:function(){t(".gehc-no-finder-results",this.el).hide(),t(".paginated-items li.page",this.el).hide(),this.itemList.stop(!0,!0),this.itemList.css({left:"0"}),this.itemList.addClass("loading")},hideLoadingIndicator:function(n){this.itemList.removeClass("loading"),n==0?(t(".gehc-no-finder-results",this.el).show(),t(this.controllerEl).hide()):(t(".paginated-items li.page",this.el).fadeIn("fast"),t(this.controllerEl).fadeIn("fast"))}}))})(this,jQuery)