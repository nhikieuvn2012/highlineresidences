var mediaGallery=function(){(function(n){var c=window.gehc,u,r;if(n(".gallery",".hero")){var f=function(t,i){r.parent(".thumbnail").each(function(){var r=n(this);r.removeClass("active"),t!==null&&t==r.index()&&(o.size()>0?r.parent().index()==i&&r.addClass("active"):r.addClass("active"))})},l=function(t){var t=t.index(),i=n(".carousel",".hero"),u=n(".slide",i),r=u.outerWidth(),e,h,s,o;i.width(u.outerWidth(!0)*u.size()),e=i.width(),Math.ceil(e/r)>e/r&&(i.width(Math.ceil(e/r)*r),e=i.width()),s=i.position().left,n.browser.msie&&(o=s/r,/\.[0-9]+/.test(o)&&(o=Math.floor(o)),o*=r),h=t*-r,r*t!=-s?i.fadeOut(200,function(){f(t),c.util.responsive.mode=="mobile"&&u.each(function(){n(this).index()==t?n(this).show():n(this).hide()}),i.css({left:h}).fadeIn(1e3)}):(f(t),c.util.responsive.mode=="mobile"&&u.each(function(){n(this).index()==t?n(this).show():n(this).hide()}))},p=function(r){if(!r.hasClass("active")){var u=n(".focus-content"),o=function(){u.find(".videoBox").remove(),c(!1)},s=function(n){Modernizr.opacity?i.fadeTo(200,.25,function(){o(),l(),i.fadeTo(800,1)}):(o(),l());var t=n==!0?null:r.index();f(t,r.parent().index())},h=function(t){if(t==!1)n(".closebox").remove();else{var i=document.createElement("div");i.innerHTML="close",n(i).attr("class","closebox"),u.prepend(i),n(i).bind("click",function(){e="defaults",s(!0),n(this).remove()})}},c=function(n){var t=u.find(".tourWrapper");n==!1&&t.is(":visible")?(t.hide(),u.css({height:""})):n==!0&&t.is(":hidden")&&(u.css({height:u.height()}),t.show(),u.animate({height:680},{duration:250,easing:"jswing"}))},l=function(){var o=r.find("a"),f=o[0].href,s;if(f.match(/\.[jpengifashx]{3,4}$/gi)&&(f="url("+f+")"),t.className="modal",t.backgroundColor="#000",t.backgroundImage="none",t.focusImage="none",e=="defaults"?(t.className=y.className,t.backgroundColor=y.backgroundColor,t.backgroundImage=y.backgroundImage,h(!1),u.find(".main-video").show()):(n(".closebox").size()==0&&h(!0),u.find(".main-video").hide(),s=u.find(".main-video video"),s.length>0&&s.get(0).pause()),e=="full-bleed"&&(t.backgroundColor="transparent",t.backgroundImage=f),e=="image"&&(t.focusImage=f),e=="video"){var a=n('<div class="videoBox"><\/div>'),v=o.attr("data-width"),p=o.attr("data-height"),l={};v&&(l.width=v),p&&(l.height=p),u.append(a),gehc.util.embedVideo(f,a,l)}e=="tour-collection"&&(t.backgroundColor="transparent",c(!0)),e=="threesixty"&&alert("360 to come"),i.attr("class","hero "+t.className.replace(/hero\s/,"")),i.css({backgroundColor:t.backgroundColor,backgroundImage:t.backgroundImage}),u.css({backgroundImage:t.focusImage})},e=r.attr("class").replace(/\s+/,"").replace(/thumbnail/,"").replace(/active/,"")||"full-bleed";s(!1)}},w=function(t,i){var r=parseInt(n(i).offset().left)-1,u=parseInt(n(i).width()/2)-1,f=parseInt(h.outerWidth(!0)/2),e=parseInt((n("body").outerWidth(!0)-n(".media-gallery").outerWidth(!0))/2);h.css({left:r+u-f-e})},a=n(".thumbnails",".media-gallery"),e=n(".carousel",a),o=n(".set",e),v=n(".thumbnail",a),s=v.outerWidth(!0)*v.size();if(e.css({visibility:"hidden"}),o.size()>1&&(s=v.outerWidth(!0)*5,o.each(function(){n(this).width(s)})),a.width(s),e.width(s*o.size()),e.css({visibility:"visible"}),u=n(".media-gallery",".gallery").size()>0?".media-gallery":".image-gallery",r=n(".thumbnails .thumbnail a",u),u==".media-gallery"){var i=n(".hero"),y={className:i.attr("class"),backgroundColor:i.css("backgroundColor"),backgroundImage:i.css("backgroundImage"),focusImage:i.find(".focus-content").css("backgroundImage")},t={className:"",backgroundColor:"",backgroundImage:"",focusImage:""},h=n(".media-gallery-popup");r.bind("mouseenter",function(n){w(n,this),h.fadeIn(200),popupIsActive=!0}),r.bind("mouseleave",function(){popupIsActive=!1;var n=window.setTimeout(function(){popupIsActive==!1&&h.fadeOut(200)},200)})}else f(0);pubsub.subscribe("gehc.util.responsive",function(){var t=n(".media-gallery",".gallery").size()>0?".media-gallery":".image-gallery",i=n(".carousel",".hero");if(i.length>0){var r=n(".slide",i),f=n(".thumbnails",t),u=f.find(".active");c.util.responsive.mode=="mobile"&&t!=".media-gallery"?r.each(function(){n(this).index()==u.index()?n(this).show():n(this).hide()}):t!=".media-gallery"&&(r.each(function(){n(this).show()}),l(u))}}),r.bind("click",function(t){t.preventDefault(),u==".media-gallery"?p(n(this).parent()):l(n(this).parent())}),r.each(function(){n(this).addSwipeEvents().bind("tap",function(t){t.preventDefault(),u==".media-gallery"?(p(n(this).parent()),n("html,body").animate({scrollTop:150},500)):l(n(this).parent())})})}})(jQuery)}