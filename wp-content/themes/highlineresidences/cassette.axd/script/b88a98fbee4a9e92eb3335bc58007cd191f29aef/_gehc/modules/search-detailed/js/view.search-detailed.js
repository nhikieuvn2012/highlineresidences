(function(n,t){extend("gehc._prototypes.searchDetailed.view.main",Backbone.View.extend({events:{},initialize:function(n){var i;i=this,n=n||{},_.defaults(this,n),this.viewPrototypes={},this.collectionPrototypes={},_.defaults(this.viewPrototypes,{creator:gehc._prototypes.searchDetailed.view.creator,paginatorContent:gehc._prototypes.searchDetailed.view.paginatorContent,paginatorController:gehc._prototypes.searchDetailed.view.paginatorController,filterableResults:gehc._prototypes.searchDetailed.view.filterableResults,filterControl:gehc._prototypes.searchDetailed.view.filterControl,activeFilterList:gehc._prototypes.searchDetailed.view.activeFilterList,filterControlArray:gehc._prototypes.searchDetailed.view.filterControlArray,filterMenu:gehc._prototypes.searchDetailed.view.filterMenu,sortControl:gehc._prototypes.searchDetailed.view.sortControl,resultsTypeController:gehc._prototypes.searchDetailed.view.resultsTypeController}),this.viewEls={},_.defaults(this.viewEls,{creator:t(".gehc-search-detailed-creator-view"),paginatorContent:t(".paginator-content-view"),paginatorController:t(".paginator-controller-view"),filterableResults:t(".filterResults"),filterControl:t(".filterCategories"),activeFilterList:t(".activeFilterList"),filterControlArray:t(),filterMenu:t(".controls"),sortControl:t(".sort"),resultsTypeController:t()}),_.defaults(this.collectionPrototypes,{paginatorCollection:gehc._prototypes.paginator.collection.contentItems}),_.extend(this.viewPrototypes,n.viewPrototypes),this.paginatorCollection=new this.collectionPrototypes.paginatorCollection([],{url:gehc._prototypes.searchDetailed.util.SEARCH_URL}),this.creatorView=new this.viewPrototypes.creator({el:this.viewEls.creator}),this.paginatorContent=new this.viewPrototypes.paginatorContent({el:this.viewEls.paginatorContent}),this.paginatorController=new this.viewPrototypes.paginatorController({el:this.viewEls.paginatorController,contentView:this.paginatorContent,collection:this.paginatorCollection}),this.filterableResults=new this.viewPrototypes.filterableResults({el:this.viewEls.filterableResults,paginatorController:this.paginatorController,searchUrl:"test"}),this.sortControl=new this.viewPrototypes.sortControl({el:this.viewEls.sortControl}),this.filterControl=new this.viewPrototypes.filterControl({el:this.viewEls.filterControl}),this.filterMenu=new this.viewPrototypes.filterMenu({el:this.viewEls.filterMenu}),this.activeFilterList=new this.viewPrototypes.activeFilterList({el:this.viewEls.activeFilterList}),this.resultsTypeController=new this.viewPrototypes.resultsTypeController({}),pubsub.subscribe("searchDetailed.resetFilters",function(){var n=t(i.filterControl.el),r=n.find("input.radio"),u=n.find("span.checked");u.removeClass("checked"),t.each(r,function(n,t){t.checked=!1})}),typeof openOnLoad!="undefined"&&openOnLoad&&this.creatorView.createSearch()}})),extend("gehc._prototypes.searchDetailed.view.creator",gehc._prototypes.search.view.creator.extend({events:{"click .submit-button":"submitButtonClick","keyup .search-input":"keyup"},initialize:function(n){this.namespace="searchDetailed",this.inputSelector="#gehc-filter-input",gehc._prototypes.search.view.creator.prototype.initialize.call(this,n),t(".gehc-search-detailed-creator-view").submit(function(){return!1})},submitButtonClick:function(n){this.submit(n)},keyup:function(n){n.keyCode==13&&this.submit(n)},submit:function(n){n.preventDefault(),this.createSearch(),t(".filterResults").show()}})),extend("gehc._prototypes.searchDetailed.view.activeFilterList",Backbone.View.extend({events:{"click .activeFilter":"activeFilterClick"},initialize:function(){var n;n=this,this.parentObj=this.el.parent("div"),this.filterLength=0,pubsub.subscribe("searchDetailed.changeFilter",function(t){n.updateFilters(t)}),pubsub.subscribe("searchDetailed.clearFilterButtons",function(){n.clearAllFilterButtons()}),pubsub.subscribe("searchDetailed.removeFilter",function(t,i){n.removeFilter(t,i)})},activeFilterClick:function(n){var r,f,e,i,u;r=t(n.currentTarget),f=t(n.currentTarget).parent(),i=r.attr("value"),e=r.attr("data-filter-type"),pubsub.publish("searchDetailed.removeFilter",[e,i]),pubsub.publish("searchDetailed.sendUpdatedFilterData"),f.remove(),u=t(':radio[value="'+i+'"],:checkbox[value="'+i+'"]'),u.attr("checked",!1),t.uniform.update(u),t(':radio[value="'+i+'"],:checkbox[value="'+i+'"]').parent("span").removeClass("checked"),this.el.children("li").length===0&&this.hideFilterWrapper()},clearAllFilterButtons:function(){this.el.children("li").remove(),this.hideFilterWrapper()},showFilterWrapper:function(){this.parentObj.css("display","block")},hideFilterWrapper:function(){this.parentObj.css("display","none")},removeFilter:function(){},updateFilters:function(n){var i,r;i=this,this.filterLength=0,this.el.children("li").remove(),t.each(_.keys(n),function(u,f){i.filterLength+=+n[f].length,r=f,n[f].length>0&&t.each(n[f],function(n,u){if(u instanceof Array)t.each(u,function(n,u){var f=t('input[value="'+u+'"]'),e=f.parents("label"),o=e.text();i.el.append('<li><button data-filter-type="'+r+'"type="button" value="'+u+'" class="activeFilter">'+o+"<\/button><\/li>")});else{var f=t('input[value="'+u+'"]'),e=f.parents("label"),o=e.text();i.el.append('<li><button data-filter-type="'+r+'"type="button" value="'+u+'" class="activeFilter">'+o+"<\/button><\/li>")}})}),this.filterLength>0&&this.showFilterWrapper()}})),extend("gehc._prototypes.searchDetailed.view.filterControlArray",Backbone.View.extend({})),extend("gehc._prototypes.searchDetailed.view.filterMenu",Backbone.View.extend({events:{"click .filter-button":"clickFilterButton"},initialize:function(){var n;this.currentGroup=null,this.buttons=t(".controls button"),this.filterSets=t(".filterCategories .group"),this.filterWrapper=t(".filterCategories"),this.filterResult=t(".filterResults"),n=this,pubsub.subscribe("searchDetailed.closeAllFilterButtons",function(){n.closeAllFilterButtons()})},clickFilterButton:function(n){var i;i=t(n.currentTarget),this.currentGroup==null?(this.addActiveClass(i),this.currentGroup=i.parent().index(),this.activateFilterSet(this.currentGroup)):this.currentGroup!==null&&(this.currentGroup===i.parent().index()?(this.removeActiveClass(i),this.deactivateFilterSet(this.currentGroup),this.closeFilterWrapper(),this.currentGroup=null):(this.removeActiveClass(t(this.buttons[this.currentGroup])),this.deactivateFilterSet(this.currentGroup),this.addActiveClass(i),this.currentGroup=i.parent().index(),this.activateFilterSet(this.currentGroup)))},addActiveClass:function(n){n.addClass("active")},removeActiveClass:function(n){n.removeClass("active")},openFilterWrapper:function(){t(this.filterWrapper).addClass("open").animate({height:vsa.getNaturalHeight(this.filterWrapper)},100),t(this.filterResult).css("display","block")},closeAllFilterButtons:function(){var n=this;t(this.buttons).each(function(){n.removeActiveClass(t(this))}),n.closeFilterWrapper(),this.currentGroup=null,t(".group").removeClass("open")},closeFilterWrapper:function(){t(this.filterWrapper).animate({height:0},100,function(){t(this).removeClass("open")}),t(this.filterResult).css("display","none")},activateFilterSet:function(n){var i=this;this.showGroup(n),t(this.filterWrapper).hasClass("open")||this.openFilterWrapper()},deactivateFilterSet:function(n){this.hideGroup(n)},showGroup:function(n){var i=this,r=t("form.group").eq(n);t("form.group").eq(n).addClass("open"),t("form.group").eq(n).animate({opacity:1},100,function(){vsa.isIE&&parseInt(t.browser.version,10)<9&&this.style.removeAttribute("filter"),i.openFilterWrapper()})},hideGroup:function(n){var i=t("form.group").eq(n);t(i).animate({opacity:0},100,function(){t(this).removeClass("open")})}})),extend("gehc._prototypes.searchDetailed.view.sortControl",Backbone.View.extend({events:{"click button":"sortButtonClick"},initialize:function(){var n;n=this,this.sort={},this.buttonArray=this.el.find("button"),this.setSort(null)},sortButtonClick:function(n){n.preventDefault(),clickTarget=n.currentTarget,t.each(this.buttonArray,function(n,i){i!==clickTarget&&(t(i).removeClass("active-ascending"),t(i).removeClass("active-descending"))}),t(clickTarget).hasClass("active-ascending")?t(clickTarget).removeClass("active-ascending").addClass("active-descending"):t(clickTarget).hasClass("active-descending")?t(clickTarget).removeClass("active-descending"):t(clickTarget).addClass("active-ascending"),this.setSort(n)},setSort:function(n){var i=[];t.each(this.buttonArray,function(n,r){buttonName=t(r).attr("name"),t(r).hasClass("active-ascending")&&(i.push(buttonName),i.push("ascending")),t(r).hasClass("active-descending")&&(i.push(buttonName),i.push("descending"))}),pubsub.publish("searchDetailed.sendSortData",[i,n])}})),extend("gehc._prototypes.searchDetailed.view.filterableResults",gehc._prototypes.search.view.filterableResults.extend({events:{"click .close":"clickResetResults","click .reset":"clickResetResults"},initialize:function(n){var i;if(i=this,_.defaults(this,{expandSpeed:350}),!n.paginatorController)throw"Expecting a gehc._prototypes.paginator.view.controller in gehc._prototypes.searchDetailed.view.filterableResults instance.";pubsub.subscribe("searchDetailed.sendFilterData",function(n,t){if(i.filterData=n,t!==null){var r=i.getQueryString();i.buildSearchQueryAndUpdateResults(r)}}),pubsub.subscribe("searchDetailed.sendSortData",function(n,t){if(i.sortData=n,t!==null){var r=i.getQueryString();i.buildSearchQueryAndUpdateResults(r)}}),pubsub.subscribe("searchDetailed.createSearch",function(n){i.buildSearchQueryAndUpdateResults(n)}),pubsub.subscribe("searchDetailed.resetSearch",function(){t("#gehc-filter-input").val(""),i.hide(!0)}),gehc._prototypes.search.view.filterableResults.prototype.initialize.call(this,n),this.hide(!0)},getQueryString:function(){var n=t("#gehc-filter-input");return n.val()===n.attr("placeholder")?"":n.val()},animateToAutoHeight:function(n,t){this.el.animate({height:vsa.getNaturalHeight(this.el,!0)},{duration:n===!0?0:this.expandSpeed,complete:function(){t&&(this.el.css({height:""}),t())}})},hide:function(n,t){this.el.animate({height:0},{duration:n===!0?0:this.expandSpeed,complete:t})},buildSearchQueryAndUpdateResults:function(n){this.makeRequest(n,this.sortData,this.filterData)},syncFiltersFromDOM:function(){var n=this;t("input:radio,input:checkbox",t(".filterCategories")).each(function(i,r){var r=t(r),u=r.parents("ul").index(),f=t("ul.controls li");r.data().filterType=r.attr("data-filter-type"),r.attr("checked")&&n.collection.addFilter(r.data().filterType,r.val())})},clickResetResults:function(n){gehc._prototypes.search.view.filterableResults.prototype.clickResetResults.call(this,n),pubsub.publish("searchDetailed.clearFilterButtons"),pubsub.publish("searchDetailed.closeAllFilterButtons"),pubsub.publish("searchDetailed.resetSearch"),pubsub.publish("searchDetailed.clickReset")},makeRequest:function(n,i,r){var u,f,e=[],o=[];f=this,t.each(_.keys(r),function(n,t){if(r[t].length>0)for(u=0;u<r[t].length;u++)e.push(r[t][u]),o.push(t)}),typeof this.paginatorController!="undefined"&&(this.paginatorController.collection.resetPageData(),this.paginatorController.updateData({query:n,filters:e,filtersTypes:o,sortBy:i,startFrom:0},function(){f.animateToAutoHeight()}))}})),extend("gehc._prototypes.searchDetailed.view.paginatorController",gehc._prototypes.paginator.view.controller.extend({initialize:function(n){n=n||{},_.defaults(n,{collectionType:gehc._prototypes.paginator.collection.contentItems,collection:new gehc._prototypes.paginator.collection.contentItems({pageSize:12,pagesToCache:4})}),this.templates=gehc._prototypes.searchDetailed.template,gehc._prototypes.paginator.view.controller.prototype.initialize.call(this,n)}})),extend("gehc._prototypes.searchDetailed.view.paginatorContent",gehc._prototypes.paginator.view.content.extend({initialize:function(n){this.itemTemplate=gehc._prototypes.searchDetailed.template.item,gehc._prototypes.paginator.view.content.prototype.initialize.call(this,n)}})),extend("gehc._prototypes.searchDetailed.view.resultsTypeController",gehc._prototypes.tabs.view.controller.extend({initialize:function(n){_.defaults(this,n||{}),this.namespace=this.cid}})),extend("gehc._prototypes.searchDetailed.view.filterControl",Backbone.View.extend({events:{"change input:radio":"changeRadio","change input:checkbox":"changeCheckbox"},initialize:function(n){var t;t=this,this.collection=new gehc._prototypes.searchDetailed.collection.result([],{url:n.searchUrl}),pubsub.subscribe("searchDetailed.clickReset",function(){t.resetFilters()}),pubsub.subscribe("searchDetailed.requestFilterData",function(n){t.getFilterData(n)}),pubsub.subscribe("searchDetailed.removeFilter",function(n,i){t.collection.removeFilter(n,i)}),pubsub.subscribe("searchDetailed.sendUpdatedFilterData",function(){t.sendUpdatedFilters()}),this.getFilterData()},changeRadio:function(n){var i,r,e,u,f;i=t(n.target),r=i.parents(".group"),e=""+r.index(".group"),u=i.attr("value"),f=i.data().filterType,this.changeFilter(u,f,n)},changeCheckbox:function(n){var i,r,o,u,f,e;i=t(n.target),r=i.parents(".group"),o=""+r.index(".group"),u=[],f=r.find("input:checkbox").filter(":checked"),f.each(function(){var n=t(this);u.push(n.attr("value"))}),e=i.data("filter-type"),this.changeFilter(u,e,n)},changeFilter:function(n,t,i){this.collection.addFilter(t,n),pubsub.publish("searchDetailed.changeFilter",[this.collection.activeFilters]),pubsub.publish("searchDetailed.sendFilterData",[this.collection.activeFilters,i])},resetFilters:function(){pubsub.publish("searchDetailed.resetFilters",[]),this.collection.resetFilters()},getFilterData:function(){pubsub.publish("searchDetailed.sendFilterData",[this.collection.activeFilters,null])},sendUpdatedFilters:function(){pubsub.publish("searchDetailed.sendFilterData",[this.collection.activeFilters,"NOT NULL"])}}))})(this,jQuery)