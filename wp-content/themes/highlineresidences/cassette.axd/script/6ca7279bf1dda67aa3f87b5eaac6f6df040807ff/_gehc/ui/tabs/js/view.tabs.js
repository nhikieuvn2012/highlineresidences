(function(n,t){extend("gehc._prototypes.tabs.view.controller",Backbone.View.extend({initialize:function(n){var i,r;n=n||{},_.defaults(this,n),i=this,this.$tabContainer=t(this.el),this.origTabHtml=this.$tabContainer.html(),this.activeTab=0,this.isOnWindowLoad=!0,this.tapFlag=!1,_.throttle(function(){i.checkTabOverflow()},500),t(window).bind("resize load",function(){i.$tabContainer.length>0&&(i.checkTabOverflow(),i.isOnWindowLoad=!1,clearTimeout(r),r=setTimeout(i.windowDoneResizing,500))}),this.$tabContainer.delegate("a.gehc-overflow-dropdown-text","click touchstart",function(n){n.preventDefault();var r=t(this).parent(".gehc-overflow-dropdown"),u=r.find("ul");i.tapFlag||(i.tapFlag=!0,setTimeout(function(){i.tapFlag=!1},100),r.hasClass("gehc-overflow-dropdown-hover")?(u.hide(),r.removeClass("gehc-overflow-dropdown-hover")):(u.show(),r.addClass("gehc-overflow-dropdown-hover")))}),this.$tabContainer.delegate("a","click",function(n){var u=t(n.currentTarget),r;n.preventDefault(),u.parent().hasClass("gehc-overflow-dropdown")||(r=i.$tabContainer.find(".gehc-overflow-dropdown"),r.hasClass("gehc-overflow-dropdown-hover")&&(r.find("ul").hide(),r.removeClass("gehc-overflow-dropdown-hover")),i.gotoTab(u))}),this.$tabs=this.$tabContainer.find("li"),this.$tabs.eq(this.activeTab).addClass("active_")},windowDoneResizing:function(){pubsub.publish("gehc.util.recalculateTabHeights")},checkTabOverflow:function(){if(!this.tapFlag){if(this.isOnWindowLoad||(this.$tabContainer.html(this.origTabHtml),this.$tabs=this.$tabContainer.find("li"),this.$tabs.eq(this.activeTab).addClass("active_")),this.$tabs=this.$tabContainer.find("li"),this.$tabs.length==0)return!1;var i=t(this.$tabs[0]).offset().top,n=!1;this.$tabs.css({visibility:"hidden"}).each(function(){var r=t(this).offset().top;if(t(this).offset().top!==i)return n=!0,!1}),n?(this.$tabContainer.html(this.origTabHtml),this.$tabs=this.$tabContainer.find("li"),this.$tabs.eq(this.activeTab).addClass("active_"),this.manageTabOverflow()):this.$tabs.css({visibility:""})}},manageTabOverflow:function(){var r,f,h,e,n,i;if(r={more:[]},f=gehc._prototypes.tabs.template.MORE_TABS,h=this,this.$tabContainer.width(function(){var n=0;return t(this).width()>265&&(n=t(this).width()-265),n}),e=t(this.$tabs[0]).offset().top,n=-1,this.$tabs.each(function(){var i=t(this),r=i.offset().top;if(i.offset().top!==e)return n=i.index(),!1}),n>0){for(i=n;i<this.$tabs.length;i++){var o=t(this.$tabs[i]),s=o.find("a"),c={id:s[0].hash||"#",tabName:s.html()};o.remove(),r.more.push(c)}if(t(Mustache.to_html(f,r)).appendTo(this.el),this.activeTab>=n){var u=this.$tabContainer.find(".gehc-overflow-dropdown"),l=u.find("a.gehc-overflow-dropdown-text"),a=u.find("li").eq(this.activeTab-n);u.addClass("active_"),l.text(a.find("a").text())}}this.$tabContainer.css({width:""}),this.$tabs.css({visibility:""}),this.isOnWindowLoad&&pubsub.publish("gehc.util.recalculateTabHeights")},gotoTab:function(t){var i,r,u;i=this,r=gehc.util.namespacify(this.namespace,"tabs.controller.changed"),cq.start(r,function(n){var u=t.parent("li"),f=i.$tabContainer.find(".gehc-overflow-dropdown"),e;f.length>0?(e=f.find("a.gehc-overflow-dropdown-text"),t.parents(".gehc-overflow-dropdown").length>0?(f.addClass("active_"),e.text(t.text()),i.activeTab=u.index()+f.index()):(f.removeClass("active_"),e.text("More"),u.addClass("active_"),i.activeTab=u.index())):(u.addClass("active_"),i.activeTab=u.index()),pubsub.publish(r,[i.activeTab,{},function(){cq.end(n)}])}),this.$tabs.removeClass("active_"),this.$tabs.eq(this.activeTab).addClass("active_"),t.attr("href")&&(u=t.attr("href").split("#")[1],n.router.navigate("tabs/"+u,!1))}})),extend("gehc._prototypes.tabs.view.contentPanel",Backbone.View.extend({initialize:function(n){var i,f,r,u;i=this,n=n||{},_.defaults(this,n),_.defaults(this,{sizeSpeed:gehc._prototypes.tabs.util.SIZE_SPEED,fadeSpeed:gehc._prototypes.tabs.util.FADE_SPEED}),f=gehc.util.namespacify(this.namespace,"tabs.controller.changed"),this.panels=t(".tab-content",this.el),this.el.css({position:"relative"}),this.preparePanelsForTabbing(),this.updateContentHeightData(),this.gotoPanel(n.startingAt||0,{noAnimate:!0}),this.currentIndex=0,r=t(this.panels.eq(0)).find("img"),u=0,r.each(function(){t(this).load(function(){if(u++,u==r.length){i.updateContentHeightData();var n={};n.index=i.currentIndex,i.changeSize(n)}})}),pubsub.subscribe("gehc.util.recalculateTabHeights",function(){if(i.panels.length>0){var n={};n.index=i.currentIndex,i.updateContentHeightData(),i.changeSize(n)}}),pubsub.subscribe(f,function(n,t,r){i.gotoPanel(n,{},r)})},preparePanelsForTabbing:function(){this.panels.each(function(n,i){i=t(i),i.css({display:"none",position:"absolute"}).fadeTo(0,0)})},updateContentHeightData:function(){this.panels.each(function(n,i){i=t(i),i.data("tabsData",{naturalHeight:vsa.getNaturalHeight(i,!0)})})},hideContent:function(n,t){var i,r,u;i=this,r=Modernizr.opacity?this.fadeSpeed:0,n&&n.noAnimate===!0&&(r=0),u=this.panels.length,this.panels.css({"z-index":""}).fadeTo(r,0,function(){u--,u===0&&(i.updateContentHeightData(),i.panels.css({display:"none"}),t())})},showContent:function(n,i){var u,r;u=Modernizr.opacity?this.fadeSpeed:0,(n&&n.noAnimate)===!0&&(u=0),r=this.panels.eq(n.index),r.css({"z-index":50,visibility:""}).fadeTo(u,1,function(){!vsa.isIE||vsa.isIE&&parseInt(t.browser.version,10)>8?r.css({opacity:""}):r[0].style.removeAttribute("filter"),(i||t.noop)()})},changeSize:function(n,t){var i;i=n&&n.noAnimate===!0?0:this.sizeSpeed,this.el.animate({height:this.panels.eq(n.index).data("tabsData").naturalHeight},{duration:i,complete:t})},gotoPanel:function(n,t,i){var r;r=this,t=t||{},t.index=n,this.currentIndex=n,this.hideContent(t,function(){r.changeSize(t,function(){r.showContent(t,i)})})}}))})(this,jQuery)